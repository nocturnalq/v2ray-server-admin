version: '3.9'
services:
  v2ray-server:
    container_name: v2ray-upstream-server
    restart: unless-stopped
    image: v2fly/v2fly-core:{{ v2ray_version }}
    environment:
      - v2ray.vmess.aead.forced=false
    ports:
      - "{{ inbounds.port}}:{{ inbounds.port}}"
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "3"
    volumes:
      - "./server-config.json:/etc/v2ray/config.json"
      - "./logs:/var/log/v2ray/"
    networks:
      - v2yay-net

  pihole:
    container_name: pihole-server
    image: pihole/pihole:latest
    expose:
      - 53
      - 67
      - 80
      - 443
    environment:
      ServerIP: 10.77.10.7
    env_file:
      - ./pihole.env
    volumes:
      - ./ph/etc.pihole:/etc/pihole/
      - ./ph/etc.dnsmasq.d/:/etc/dnsmasq.d/
    cap_add:
      - NET_ADMIN
    restart: unless-stopped
    networks:
      - v2yay-net

networks:
  v2yay-net:
    name: v2yay-net